<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Analizador SQL Empresarial - An√°lisis avanzado de c√≥digo SQL con IA">
    <meta name="keywords" content="SQL, an√°lisis, base de datos, optimizaci√≥n, seguridad">
    <meta name="author" content="SQL Analyzer Enterprise">
    <title>An√°lisis SQL - SQL Analyzer Enterprise</title>

    <!-- CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link href="/static/css/main.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            min-height: 100vh;
            color: #000000;
            /* High contrast black text */
            line-height: 1.6;
        }

        .navbar {
            background: #ffffff;
            padding: 1rem 0;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            color: #2c3e50 !important;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .back-btn {
            color: #6c757d;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid #dee2e6;
        }

        .back-btn:hover {
            background-color: #f8f9fa;
            color: #495057;
        }

        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .analysis-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .analysis-layout {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 0.5rem;
                margin: 1rem auto;
            }

            .analysis-layout {
                gap: 1rem;
            }
        }

        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #667eea;
            background-color: #f7fafc;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .upload-area:focus-within {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }

        .upload-area.dragover {
            border-color: #4c51bf;
            background-color: #edf2f7;
            transform: scale(1.02);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.25);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(108, 117, 125, 0.1), transparent);
            transition: left 0.5s;
            pointer-events: none;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-icon {
            font-size: 3rem;
            color: #a0aec0;
            margin-bottom: 1rem;
        }

        .upload-text {
            color: #000000;
            /* High contrast black */
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .upload-subtext {
            color: #333333;
            /* Dark gray for better contrast */
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .analysis-options {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            display: none;
        }

        .option-group {
            margin-bottom: 1.5rem;
        }

        .option-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-check {
            margin-bottom: 0.5rem;
        }

        .analyze-btn {
            background: #007bff;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            width: 100%;
            transition: all 0.2s;
        }

        .analyze-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* Enhanced Interactive Elements */
        .btn,
        .form-control,
        .form-check-input,
        .form-range {
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .card {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }

        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }

        .form-range::-webkit-slider-thumb {
            background: #667eea;
            transition: all 0.3s ease;
        }

        .form-range::-webkit-slider-thumb:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .progress-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .download-btn {
            background: #48bb78;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        .download-btn:hover {
            background: #38a169;
        }

        /* Statistics Panel Styles */
        .statistics-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-top: 2rem;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            border-left: 4px solid #667eea;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 0.5rem 0;
        }

        .stat-card h5 {
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-card small {
            font-size: 0.8rem;
        }

        #commonErrors .d-flex,
        #popularFormats .d-flex {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        /* ========================================================================
           MODAL STYLES - Modern Dialog Implementation
           ======================================================================== */

        dialog {
            border: none;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            background: #ffffff;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease-out;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
        }

        dialog::backdrop {
            background: rgba(0, 0, 0, 0.5);
            animation: backdropFadeIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes backdropFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-header {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 1.5rem 2rem;
            margin: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: #6c757d;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: #e9ecef;
            color: #495057;
        }

        .modal-body {
            padding: 2rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1rem 2rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: #f8f9fa;
        }

        /* Results Modal Specific Styles */
        .results-modal {
            width: 95vw;
            max-width: 1200px;
        }

        .results-modal .modal-body {
            padding: 1rem;
        }

        /* Configuration Modal Styles */
        .config-modal {
            width: 90vw;
            max-width: 600px;
        }

        /* Responsive modal adjustments */
        @media (max-width: 768px) {
            dialog {
                max-width: 95vw;
                max-height: 95vh;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .modal-header {
                padding: 1rem 1.5rem;
            }

            .modal-body {
                padding: 1.5rem;
                max-height: 60vh;
            }

            .modal-footer {
                padding: 1rem 1.5rem;
                flex-direction: column;
                gap: 0.5rem;
            }

            .results-modal,
            .config-modal {
                width: 95vw;
            }
        }

        @media (max-width: 480px) {
            dialog {
                max-width: 98vw;
                max-height: 98vh;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .modal-header {
                padding: 1rem;
            }

            .modal-body {
                padding: 1rem;
                max-height: 70vh;
            }

            .modal-footer {
                padding: 1rem;
            }
        }

        /* Blur effect for background when modal is open */
        body.modal-open .main-container {
            filter: blur(3px);
            transition: filter 0.3s ease;
        }

        body.modal-open .navbar {
            filter: blur(3px);
            transition: filter 0.3s ease;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="fas fa-database me-2"></i>SQL Analyzer Enterprise
            </span>
            <a href="/" class="back-btn">
                <i class="fas fa-arrow-left me-2"></i>Back to Home
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- File Upload Section -->
        <div class="upload-section">
            <h2 class="mb-4">
                <i class="fas fa-upload me-2"></i>Cargar Archivo SQL
            </h2>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    Arrastre y coloque su archivo SQL aqu√≠
                </div>
                <div class="upload-subtext">
                    o haga clic para seleccionar (Compatible con archivos .sql, .txt hasta 10GB)
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".sql,.txt" />
            </div>

            <div id="fileInfo" class="mt-3" style="display: none;">
                <div class="alert alert-info">
                    <i class="fas fa-file-alt me-2"></i>
                    <span id="fileName"></span>
                    <span class="badge bg-secondary ms-2" id="fileSize"></span>
                </div>
            </div>
        </div>

        <!-- Analysis Options -->
        <div class="analysis-options" id="analysisOptions">
            <h3 class="mb-4">
                <i class="fas fa-cogs me-2"></i>Configuraci√≥n del An√°lisis
            </h3>

            <div class="row">
                <div class="col-md-6">
                    <div class="option-group">
                        <label class="option-label">Analysis Types</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="errorDetection" checked>
                            <label class="form-check-label" for="errorDetection">
                                Error Detection & Correction
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="codeCommenting" checked>
                            <label class="form-check-label" for="codeCommenting">
                                Intelligent Code Commenting
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="schemaAnalysis">
                            <label class="form-check-label" for="schemaAnalysis">
                                Schema Analysis
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="securityScan">
                            <label class="form-check-label" for="securityScan">
                                Security Vulnerability Scan
                            </label>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="option-group">
                        <label class="option-label" for="downloadFormatSelect">
                            <i class="fas fa-download me-2"></i>Formato de Exportaci√≥n
                        </label>
                        <select class="form-select" id="downloadFormatSelect" name="downloadFormat"
                            data-bs-toggle="tooltip" data-bs-placement="top"
                            title="Seleccione el formato de exportaci√≥n para el informe de an√°lisis">
                            <option value="enhanced_sql" selected>üìÑ SQL Mejorado - Archivo SQL con comentarios
                                inteligentes</option>
                            <option value="html_report">üåê Reporte HTML - Reporte con CSS embebido y elementos
                                interactivos</option>
                            <option value="interactive_html">üìä Dashboard HTML Interactivo - Gr√°ficos en tiempo real con
                                Chart.js</option>
                            <option value="pdf_report">üìã Reporte PDF - Reporte profesional con formato y gr√°ficos
                            </option>
                            <option value="json_analysis">üîß Datos JSON - Datos de an√°lisis estructurados</option>
                            <option value="xml_report">üì∞ Reporte XML - Resultados en formato XML compatible</option>
                            <option value="csv_summary">üìä Resumen CSV - Resumen tabular de errores y m√©tricas</option>
                            <option value="excel_workbook">üìà Libro Excel - An√°lisis multi-hoja con gr√°ficos</option>
                            <option value="word_document">üìù Documento Word - Reporte profesional en formato Word
                            </option>
                            <option value="markdown_docs">üìö Documentaci√≥n Markdown - Compatible con GitHub</option>
                            <option value="latex_report">üéì Reporte LaTeX - Reporte acad√©mico profesional</option>
                            <option value="powerpoint">üéØ Presentaci√≥n PowerPoint - Diapositivas de resumen ejecutivo
                            </option>
                            <option value="sqlite_database">üóÑÔ∏è Base de Datos SQLite - Resultados consultables</option>
                            <option value="zip_archive">üì¶ Archivo ZIP - M√∫ltiples formatos empaquetados</option>
                            <option value="plain_text">üìÑ Reporte de Texto - Salida compatible con consola</option>
                            <option value="yaml_config">‚öôÔ∏è Configuraci√≥n YAML - Exportaci√≥n estructurada</option>
                            <option value="schema_diagram">üé® Diagrama de Esquema - Gr√°ficos vectoriales SVG</option>
                            <option value="jupyter_notebook">üî¨ Notebook Jupyter - An√°lisis ejecutable</option>
                            <option value="python_script">üêç Script Python - Generador de an√°lisis independiente
                            </option>
                        </select>
                        <div class="form-text">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Seleccione el formato que mejor se adapte a sus necesidades de an√°lisis
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enterprise Features Section -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="option-group">
                        <label class="option-label" for="enterpriseFeatureSelect">
                            <i class="fas fa-rocket me-2"></i>Funcionalidades Empresariales
                        </label>
                        <select class="form-select" id="enterpriseFeatureSelect" name="enterpriseFeature"
                            data-bs-toggle="tooltip" data-bs-placement="top"
                            title="Seleccione una funcionalidad empresarial avanzada para an√°lisis especializado">
                            <option value="none" selected>üîß An√°lisis Est√°ndar - Detecci√≥n de errores y correcciones
                                b√°sicas</option>
                            <option value="ultra_large_processing">üöÄ Procesamiento Ultra-Grande - Archivos hasta 100GB
                                con streaming</option>
                            <option value="schema_visualization">üé® Mapeo y Visualizaci√≥n de Esquemas - Diagramas ER
                                interactivos</option>
                            <option value="performance_optimization">‚ö° Optimizaci√≥n de Rendimiento - An√°lisis de planes
                                de consulta</option>
                            <option value="security_audit">üîí Auditor√≠a de Seguridad - Detecci√≥n de inyecci√≥n SQL y
                                vulnerabilidades</option>
                            <option value="database_migration">üîÑ Asistente de Migraci√≥n - Traducci√≥n entre plataformas
                                de BD</option>
                            <option value="collaborative_analysis">üë• An√°lisis Colaborativo - Edici√≥n multi-usuario en
                                tiempo real</option>
                            <option value="advanced_reporting">üìä Generaci√≥n de Reportes Avanzados - Documentaci√≥n
                                auto-generada</option>
                            <option value="code_quality_metrics">üìà M√©tricas de Calidad de C√≥digo - Puntuaci√≥n de
                                complejidad</option>
                            <option value="api_integration">üîå Integraci√≥n Empresarial - Gateway API con OpenAPI
                            </option>
                            <option value="ml_predictive_analysis">ü§ñ An√°lisis Predictivo ML - Reconocimiento de
                                patrones inteligente</option>
                        </select>
                        <div class="form-text">
                            <small class="text-muted">
                                <i class="fas fa-star me-1"></i>
                                Las funcionalidades empresariales proporcionan an√°lisis especializado y capacidades
                                avanzadas
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <button class="analyze-btn" id="startAnalysis">
                <i class="fas fa-play me-2"></i>Ejecutar An√°lisis
            </button>

            <!-- Advanced Options Panel -->
            <div class="mt-4">
                <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse"
                    data-bs-target="#advancedOptions" aria-expanded="false" aria-controls="advancedOptions">
                    <i class="fas fa-cog me-2"></i>Configuraci√≥n Avanzada
                </button>

                <div class="collapse mt-3" id="advancedOptions">
                    <div class="card card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeRecommendations" checked>
                                    <label class="form-check-label" for="includeRecommendations">
                                        Incluir recomendaciones detalladas
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="detailedErrors" checked>
                                    <label class="form-check-label" for="detailedErrors">
                                        Errores con informaci√≥n detallada
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeRelationships" checked>
                                    <label class="form-check-label" for="includeRelationships">
                                        Analizar relaciones de esquema
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeConstraints" checked>
                                    <label class="form-check-label" for="includeConstraints">
                                        Incluir restricciones de BD
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generateSampleData">
                                    <label class="form-check-label" for="generateSampleData">
                                        Generar datos de prueba
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enableRealTimeAnalysis">
                                    <label class="form-check-label" for="enableRealTimeAnalysis">
                                        An√°lisis en tiempo real
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection">
            <h3 class="mb-4">
                <i class="fas fa-spinner fa-spin me-2"></i>Analyzing SQL File
            </h3>

            <div class="progress mb-3" style="height: 20px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar"
                    style="width: 0%"></div>
            </div>

            <div id="progressText" class="text-center text-muted">
                Initializing analysis...
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <h3 class="mb-4">
                <i class="fas fa-check-circle text-success me-2"></i>An√°lisis Completado
            </h3>

            <div id="analysisResults">
                <!-- Results will be populated here -->
            </div>

            <!-- Post-Analysis Features -->
            <div class="post-analysis-features mt-4" id="postAnalysisFeatures">
                <h4 class="mb-3">
                    <i class="fas fa-tools me-2"></i>Funciones Adicionales
                </h4>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-warning w-100" id="autoFixBtn">
                            <i class="fas fa-magic me-2"></i>Corregir Errores Autom√°ticamente
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-info w-100" id="addCommentsBtn">
                            <i class="fas fa-comment-alt me-2"></i>Agregar Comentarios
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-success w-100" id="generateDataBtn">
                            <i class="fas fa-database me-2"></i>Generar Datos de Prueba
                        </button>
                    </div>
                </div>

                <!-- Sample Data Configuration -->
                <div class="sample-data-config mt-3" id="sampleDataConfig" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Configuraci√≥n de Datos de Prueba</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="recordsSlider" class="form-label">
                                        Registros por tabla: <span id="recordsValue">100</span>
                                    </label>
                                    <input type="range" class="form-range" id="recordsSlider" min="10" max="10000"
                                        value="100" step="10">
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="realisticData" checked>
                                        <label class="form-check-label" for="realisticData">
                                            Usar datos realistas
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="referentialIntegrity"
                                            checked>
                                        <label class="form-check-label" for="referentialIntegrity">
                                            Mantener integridad referencial
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary mt-3" id="generateSampleData">
                                <i class="fas fa-play me-2"></i>Generar Datos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Results Display -->
            <div class="enhanced-results mt-4" id="enhancedResults" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-code me-2"></i>SQL Mejorado
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="comparison-view" id="comparisonView">
                            <!-- Before/After comparison will be shown here -->
                        </div>
                        <pre id="enhancedSqlContent" class="bg-light p-3 rounded"
                            style="max-height: 400px; overflow-y: auto;"></pre>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <button class="download-btn" id="downloadResults">
                    <i class="fas fa-download me-2"></i>Descargar Resultados
                </button>
                <button class="btn btn-outline-primary" onclick="location.reload()">
                    <i class="fas fa-redo me-2"></i>Analizar Otro Archivo
                </button>
                <button class="btn btn-outline-info ms-2" onclick="window.sqlAnalyzer.showStatistics()">
                    <i class="fas fa-chart-bar me-2"></i>Ver Estad√≠sticas
                </button>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div class="statistics-panel" id="statisticsPanel" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>Estad√≠sticas del Sistema
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-card">
                                <h5>An√°lisis Realizados</h5>
                                <div class="stat-value" id="totalAnalyses">-</div>
                                <small class="text-muted">√öltimas 24 horas</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <h5>Archivos Procesados</h5>
                                <div class="stat-value" id="totalFiles">-</div>
                                <small class="text-muted">√öltimas 24 horas</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <h5>Puntuaci√≥n Promedio</h5>
                                <div class="stat-value" id="averageQuality">-</div>
                                <small class="text-muted">Calidad del c√≥digo</small>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h6>Errores M√°s Comunes</h6>
                            <div id="commonErrors">
                                <div class="d-flex justify-content-between">
                                    <span>Sintaxis y puntuaci√≥n</span>
                                    <span class="badge bg-warning">45%</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Rendimiento</span>
                                    <span class="badge bg-info">30%</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Seguridad</span>
                                    <span class="badge bg-danger">25%</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Formatos M√°s Utilizados</h6>
                            <div id="popularFormats">
                                <div class="d-flex justify-content-between">
                                    <span>SQL Mejorado</span>
                                    <span class="badge bg-primary">40%</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Reporte HTML</span>
                                    <span class="badge bg-success">35%</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>PDF</span>
                                    <span class="badge bg-secondary">25%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button class="btn btn-outline-secondary" onclick="window.sqlAnalyzer.hideStatistics()">
                            <i class="fas fa-times me-2"></i>Cerrar Estad√≠sticas
                        </button>
                        <button class="btn btn-outline-primary ms-2" onclick="window.sqlAnalyzer.refreshStatistics()">
                            <i class="fas fa-sync me-2"></i>Actualizar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         MODAL DIALOGS - Modern HTML Dialog Implementation
         ======================================================================== -->

    <!-- Results Modal -->
    <dialog id="resultsModal" class="results-modal">
        <div class="modal-header">
            <h3><i class="fas fa-chart-line me-2"></i>Resultados del An√°lisis</h3>
            <button class="modal-close" onclick="closeModal('resultsModal')" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="resultsModalBody">
            <!-- Results content will be dynamically inserted here -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('resultsModal')">
                <i class="fas fa-times me-2"></i>Cerrar
            </button>
            <button class="btn btn-primary" onclick="downloadCurrentResults()">
                <i class="fas fa-download me-2"></i>Descargar
            </button>
        </div>
    </dialog>

    <!-- Sample Data Configuration Modal -->
    <dialog id="sampleDataModal" class="config-modal">
        <div class="modal-header">
            <h3><i class="fas fa-database me-2"></i>Configuraci√≥n de Datos de Prueba</h3>
            <button class="modal-close" onclick="closeModal('sampleDataModal')" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="mb-4">
                <label for="recordsSliderModal" class="form-label">
                    <i class="fas fa-list-ol me-2"></i>Registros por tabla: <span id="recordsValueModal">100</span>
                </label>
                <input type="range" class="form-range" id="recordsSliderModal" min="10" max="1000" value="100"
                    oninput="document.getElementById('recordsValueModal').textContent = this.value">
            </div>

            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="realisticDataModal" checked>
                    <label class="form-check-label" for="realisticDataModal">
                        <i class="fas fa-user-check me-2"></i>Usar datos realistas (nombres, emails, etc.)
                    </label>
                </div>
            </div>

            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="referentialIntegrityModal" checked>
                    <label class="form-check-label" for="referentialIntegrityModal">
                        <i class="fas fa-link me-2"></i>Mantener integridad referencial
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('sampleDataModal')">
                <i class="fas fa-times me-2"></i>Cancelar
            </button>
            <button class="btn btn-primary" onclick="generateSampleDataFromModal()">
                <i class="fas fa-play me-2"></i>Generar Datos
            </button>
        </div>
    </dialog>

    <!-- Error Details Modal -->
    <dialog id="errorDetailsModal" class="results-modal">
        <div class="modal-header">
            <h3><i class="fas fa-exclamation-triangle me-2"></i>Detalles del Error</h3>
            <button class="modal-close" onclick="closeModal('errorDetailsModal')" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="errorDetailsModalBody">
            <!-- Error details will be dynamically inserted here -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('errorDetailsModal')">
                <i class="fas fa-times me-2"></i>Cerrar
            </button>
        </div>
    </dialog>

    <!-- Progress Modal -->
    <dialog id="progressModal" class="config-modal">
        <div class="modal-header">
            <h3><i class="fas fa-spinner fa-spin me-2"></i>Procesando...</h3>
        </div>
        <div class="modal-body">
            <div class="text-center">
                <div class="progress mb-3" style="height: 20px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar"
                        role="progressbar" style="width: 0%">
                        <span id="progressText">0%</span>
                    </div>
                </div>
                <p id="progressMessage">Iniciando an√°lisis...</p>
                <small class="text-muted" id="progressDetails">Preparando archivos...</small>
            </div>
        </div>
    </dialog>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Core JavaScript Modules - SIMPLIFIED -->
    <script src="/static/js/simple-utils.js"></script>
    <!-- ALL WEBSOCKET AND COMPLEX MODULES DISABLED -->
    <!-- <script src="/static/js/utils.js"></script> -->
    <!-- <script src="/static/js/session-manager.js"></script> -->
    <!-- <script src="/static/js/websocket-manager.js"></script> -->
    <!-- <script src="/static/js/api.js"></script> -->
    <!-- <script src="/static/js/upload.js"></script> -->
    <!-- <script src="/static/js/analysis.js"></script> -->

    <script>
        // ========================================================================
        // MODAL MANAGEMENT FUNCTIONS
        // ========================================================================

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                document.body.classList.add('modal-open');
                modal.showModal();

                // Focus management for accessibility
                const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (firstFocusable) {
                    firstFocusable.focus();
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                document.body.classList.remove('modal-open');
                modal.close();
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('dialog[open]');
            modals.forEach(modal => {
                modal.close();
            });
            document.body.classList.remove('modal-open');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'DIALOG') {
                const rect = e.target.getBoundingClientRect();
                const isInDialog = (rect.top <= e.clientY && e.clientY <= rect.top + rect.height &&
                    rect.left <= e.clientX && e.clientX <= rect.left + rect.width);
                if (!isInDialog) {
                    e.target.close();
                    document.body.classList.remove('modal-open');
                }
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        // ========================================================================
        // MODAL CONTENT FUNCTIONS
        // ========================================================================

        function showResultsInModal(result, type = 'analysis') {
            const modalBody = document.getElementById('resultsModalBody');
            const modalHeader = document.querySelector('#resultsModal .modal-header h3');

            // Update modal title based on type
            const titles = {
                'analysis': '<i class="fas fa-chart-line me-2"></i>Resultados del An√°lisis',
                'auto-fix': '<i class="fas fa-wrench me-2"></i>Correcciones Autom√°ticas',
                'comments': '<i class="fas fa-comment me-2"></i>Comentarios Agregados',
                'sample-data': '<i class="fas fa-database me-2"></i>Datos de Prueba Generados'
            };

            modalHeader.innerHTML = titles[type] || titles['analysis'];

            // Generate content based on result type
            let content = '';

            if (type === 'analysis') {
                content = generateAnalysisModalContent(result);
            } else if (type === 'auto-fix') {
                content = generateAutoFixModalContent(result);
            } else if (type === 'comments') {
                content = generateCommentsModalContent(result);
            } else if (type === 'sample-data') {
                content = generateSampleDataModalContent(result);
            }

            modalBody.innerHTML = content;
            openModal('resultsModal');
        }

        function generateAnalysisModalContent(result) {
            const summary = result.summary || {};
            const errors = result.errors || [];

            return `
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body text-center">
                                <div class="display-4 text-primary mb-2">${summary.quality_score || 0}%</div>
                                <h6 class="card-title">Puntuaci√≥n de Calidad</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body text-center">
                                <div class="display-4 text-danger mb-2">${summary.total_errors || 0}</div>
                                <h6 class="card-title">Errores Encontrados</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body text-center">
                                <div class="display-4 text-success mb-2">${summary.fixes_suggested || 0}</div>
                                <h6 class="card-title">Correcciones Sugeridas</h6>
                            </div>
                        </div>
                    </div>
                </div>

                ${errors.length > 0 ? `
                    <div class="mt-4">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Errores Detectados</h5>
                        <div class="error-list" style="max-height: 400px; overflow-y: auto;">
                            ${errors.slice(0, 10).map(error => `
                                <div class="alert alert-${getSeverityClass(error.severity)} mb-2">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <strong>${error.title || 'Error'}</strong>
                                            <p class="mb-1">${error.description || ''}</p>
                                            <small>L√≠nea: ${error.line || 'N/A'} | Severidad: ${error.severity || 'MEDIUM'}</small>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary" onclick="showErrorDetails('${error.id || ''}')">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                            ${errors.length > 10 ? `<p class="text-muted">... y ${errors.length - 10} errores m√°s</p>` : ''}
                        </div>
                    </div>
                ` : '<div class="alert alert-success mt-4"><i class="fas fa-check-circle me-2"></i>¬°Excelente! No se encontraron errores.</div>'}
            `;
        }

        function generateAutoFixModalContent(result) {
            const fixes = result.fixes || [];
            const correctedSql = result.corrected_sql || '';

            return `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        Se aplicaron ${fixes.length} correcciones autom√°ticas
                    </div>
                </div>

                ${fixes.length > 0 ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-wrench me-2"></i>Correcciones Aplicadas</h5>
                        <div class="fixes-list">
                            ${fixes.map(fix => `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h6 class="card-title">${fix.description || 'Correcci√≥n aplicada'}</h6>
                                        <p class="card-text">${fix.explanation || ''}</p>
                                        <small class="text-muted">Confianza: ${(fix.confidence * 100).toFixed(1)}%</small>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${correctedSql ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-code me-2"></i>SQL Corregido</h5>
                        <pre class="bg-light p-3 rounded" style="max-height: 300px; overflow-y: auto;"><code>${correctedSql}</code></pre>
                    </div>
                ` : ''}
            `;
        }

        function generateCommentsModalContent(result) {
            const commentedSql = result.commented_sql || '';
            const comments = result.comments || [];

            return `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="fas fa-comment me-2"></i>
                        Se agregaron ${comments.length} comentarios inteligentes
                    </div>
                </div>

                ${commentedSql ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-code me-2"></i>SQL con Comentarios</h5>
                        <pre class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto;"><code>${commentedSql}</code></pre>
                    </div>
                ` : ''}

                ${comments.length > 0 ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-list me-2"></i>Comentarios Agregados</h5>
                        <div class="comments-list">
                            ${comments.map(comment => `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h6 class="card-title">L√≠nea ${comment.line || 'N/A'}</h6>
                                        <p class="card-text">${comment.text || ''}</p>
                                        <small class="text-muted">Tipo: ${comment.type || 'General'}</small>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function generateSampleDataModalContent(result) {
            const sampleData = result.sample_data || '';
            const statistics = result.statistics || {};

            return `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="fas fa-database me-2"></i>
                        Datos de prueba generados exitosamente
                    </div>
                </div>

                ${Object.keys(statistics).length > 0 ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-chart-bar me-2"></i>Estad√≠sticas</h5>
                        <div class="row">
                            ${Object.entries(statistics).map(([key, value]) => `
                                <div class="col-md-6 mb-2">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <div class="h4 text-primary">${value}</div>
                                            <small>${key.replace(/_/g, ' ').toUpperCase()}</small>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${sampleData ? `
                    <div class="mb-4">
                        <h5><i class="fas fa-code me-2"></i>SQL de Datos de Prueba</h5>
                        <pre class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto;"><code>${sampleData}</code></pre>
                    </div>
                ` : ''}
            `;
        }

        function getSeverityClass(severity) {
            const classes = {
                'CRITICAL': 'danger',
                'HIGH': 'warning',
                'MEDIUM': 'info',
                'LOW': 'light'
            };
            return classes[severity] || 'info';
        }

        function showErrorDetails(errorId) {
            // This would show detailed error information in the error details modal
            const modalBody = document.getElementById('errorDetailsModalBody');
            modalBody.innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Detalles del error ${errorId} se mostrar√≠an aqu√≠ con informaci√≥n completa,
                    sugerencias de correcci√≥n, y ejemplos de c√≥digo.
                </div>
            `;
            closeModal('resultsModal');
            openModal('errorDetailsModal');
        }

        function downloadCurrentResults() {
            // This would trigger the download of current results
            if (window.analyzer && window.analyzer.downloadRealResults) {
                window.analyzer.downloadRealResults();
            }
            Utils.showNotification('Descarga iniciada', 'success');
        }

        function generateSampleDataFromModal() {
            const recordsPerTable = document.getElementById('recordsSliderModal').value;
            const useRealisticData = document.getElementById('realisticDataModal').checked;
            const maintainIntegrity = document.getElementById('referentialIntegrityModal').checked;

            closeModal('sampleDataModal');

            if (window.analyzer && window.analyzer.generateSampleDataWithConfig) {
                window.analyzer.generateSampleDataWithConfig(recordsPerTable, useRealisticData, maintainIntegrity);
            }
        }

        function showProgress(message, details = '') {
            document.getElementById('progressMessage').textContent = message;
            document.getElementById('progressDetails').textContent = details;
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            openModal('progressModal');
        }

        function updateProgress(percentage, message = '', details = '') {
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
            if (message) document.getElementById('progressMessage').textContent = message;
            if (details) document.getElementById('progressDetails').textContent = details;
        }

        function hideProgress() {
            closeModal('progressModal');
        }

        // Simple analysis page controller
        class SimpleAnalyzer {
            constructor() {
                this.currentFile = null;
                this.analysisId = null;
                this.analysisResult = null;
                this.init();
            }

            init() {
                // Make analyzer globally available
                window.analyzer = this;
                this.setupFileUpload();
                this.setupAnalysis();
                if (window.Utils) Utils.log('üî¨ Analysis page initialized');
            }

            setupFileUpload() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const fileInfo = document.getElementById('fileInfo');
                const fileName = document.getElementById('fileName');
                const fileSize = document.getElementById('fileSize');
                const analysisOptions = document.getElementById('analysisOptions');

                // Click to upload
                uploadArea.addEventListener('click', () => fileInput.click());

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });

                // File input change
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFile(e.target.files[0]);
                    }
                });
            }

            handleFile(file) {
                this.currentFile = file;

                // Show file info
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = this.formatFileSize(file.size);
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('analysisOptions').style.display = 'block';

                if (window.Utils) Utils.log('File selected:', file.name);
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            setupAnalysis() {
                document.getElementById('startAnalysis').addEventListener('click', () => {
                    this.startAnalysis();
                });

                // Setup post-analysis features
                this.setupPostAnalysisFeatures();
            }

            setupPostAnalysisFeatures() {
                // Auto-fix errors button
                document.getElementById('autoFixBtn').addEventListener('click', () => {
                    this.autoFixErrors();
                });

                // Add comments button
                document.getElementById('addCommentsBtn').addEventListener('click', () => {
                    this.addComments();
                });

                // Generate sample data button
                document.getElementById('generateDataBtn').addEventListener('click', () => {
                    this.toggleSampleDataConfig();
                });

                // Generate sample data with config
                document.getElementById('generateSampleData').addEventListener('click', () => {
                    this.generateSampleData();
                });

                // Records slider
                const recordsSlider = document.getElementById('recordsSlider');
                const recordsValue = document.getElementById('recordsValue');
                recordsSlider.addEventListener('input', (e) => {
                    recordsValue.textContent = e.target.value;
                });
            }

            async startAnalysis() {
                if (!this.currentFile) return;

                // Get selected options
                const downloadFormat = document.getElementById('downloadFormatSelect').value;
                const enterpriseFeature = document.getElementById('enterpriseFeatureSelect').value;

                // Get advanced options
                const includeRecommendations = document.getElementById('includeRecommendations').checked;
                const detailedErrors = document.getElementById('detailedErrors').checked;
                const includeRelationships = document.getElementById('includeRelationships').checked;
                const includeConstraints = document.getElementById('includeConstraints').checked;
                const generateSampleData = document.getElementById('generateSampleData').checked;
                const enableRealTimeAnalysis = document.getElementById('enableRealTimeAnalysis').checked;

                // Store selections for later use
                this.selectedFormat = downloadFormat;
                this.selectedEnterpriseFeature = enterpriseFeature;
                this.analysisOptions = {
                    includeRecommendations,
                    detailedErrors,
                    includeRelationships,
                    includeConstraints,
                    generateSampleData,
                    enableRealTimeAnalysis
                };

                try {
                    // Show progress modal immediately
                    showProgress('Iniciando an√°lisis...', 'Preparando archivo...');

                    // Check if enterprise feature is selected
                    if (enterpriseFeature !== 'none') {
                        await this.executeEnterpriseFeature(enterpriseFeature);
                    } else {
                        // Start real analysis
                        await this.performRealAnalysis();
                    }

                } catch (error) {
                    hideProgress();
                    if (window.Utils) {
                        Utils.error('Analysis failed:', error);
                        Utils.showNotification('Error en el an√°lisis: ' + error.message, 'error');
                    } else {
                        alert('Error en el an√°lisis: ' + error.message);
                    }
                }
            }

            async performAdvancedAnalysis() {
                try {
                    // Show progress modal
                    showProgress('Iniciando an√°lisis avanzado...', 'Preparando configuraci√≥n...');
                    updateProgress(10, 'Configurando an√°lisis...', 'Determinando tipos de an√°lisis...');

                    // Determine analysis types based on options
                    let analysisTypes = ['syntax', 'schema'];

                    if (this.analysisOptions.includeRelationships) {
                        analysisTypes.push('relationships');
                    }

                    if (this.analysisOptions.includeConstraints) {
                        analysisTypes.push('constraints');
                    }

                    updateProgress(30, 'Enviando archivo...', 'Procesando archivo SQL...');

                    // Perform advanced analysis
                    updateProgress(50, 'Ejecutando an√°lisis avanzado...', `Analizando: ${analysisTypes.join(', ')}`);

                    const result = await window.apiManager.advancedAnalysis(
                        this.currentFile,
                        analysisTypes.join(','),
                        {
                            includeRecommendations: this.analysisOptions.includeRecommendations,
                            detailedErrors: this.analysisOptions.detailedErrors
                        }
                    );

                    // Store result
                    this.analysisResult = result;

                    updateProgress(90, 'Procesando resultados...', 'Generando reporte de an√°lisis...');

                    // Show results
                    this.showAdvancedResults();

                    updateProgress(100, 'An√°lisis completado!', 'Resultados listos para visualizar');

                    setTimeout(() => {
                        hideProgress();
                    }, 1000);

                } catch (error) {
                    throw error;
                }
            }

            showAdvancedResults() {
                // Use modal instead of inline display
                showResultsInModal(this.analysisResult, 'analysis');

                // Hide old progress and results sections
                const progressSection = document.getElementById('progressSection');
                const resultsSection = document.getElementById('resultsSection');

                if (progressSection) progressSection.style.display = 'none';
                if (resultsSection) resultsSection.style.display = 'none';
            }

            getQualityScoreClass(score) {
                if (score >= 80) return 'bg-success';
                if (score >= 60) return 'bg-warning';
                return 'bg-danger';
            }

            getErrorAlertClass(severity) {
                const severityMap = {
                    'CRITICAL': 'danger',
                    'HIGH': 'warning',
                    'MEDIUM': 'info',
                    'LOW': 'light'
                };
                return severityMap[severity] || 'light';
            }

            getErrorBadgeClass(severity) {
                const severityMap = {
                    'CRITICAL': 'danger',
                    'HIGH': 'warning',
                    'MEDIUM': 'info',
                    'LOW': 'secondary'
                };
                return severityMap[severity] || 'secondary';
            }

            async executeEnterpriseFeature(featureType) {
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');

                // Update progress
                progressBar.style.width = '20%';
                progressText.textContent = 'Ejecutando funcionalidad empresarial...';

                try {
                    let result;

                    switch (featureType) {
                        case 'ultra_large_processing':
                            progressText.textContent = 'Procesando archivo ultra-grande...';
                            result = await window.apiManager.ultraLargeProcessing(this.currentFile);
                            break;

                        case 'schema_visualization':
                            progressText.textContent = 'Generando visualizaci√≥n de esquema...';
                            // First do standard analysis to get data
                            await this.performRealAnalysis();
                            result = await window.apiManager.schemaVisualization(this.analysisResult);
                            break;

                        case 'performance_optimization':
                            progressText.textContent = 'Optimizando rendimiento...';
                            const sqlContent = await this.currentFile.text();
                            result = await window.apiManager.performanceOptimization(sqlContent);
                            break;

                        case 'security_audit':
                            progressText.textContent = 'Ejecutando auditor√≠a de seguridad...';
                            const sqlContentSec = await this.currentFile.text();
                            result = await window.apiManager.securityAudit(sqlContentSec);
                            break;

                        case 'database_migration':
                            progressText.textContent = 'Preparando migraci√≥n de base de datos...';
                            const sqlContentMig = await this.currentFile.text();
                            result = await window.apiManager.databaseMigration('mysql', 'postgresql', sqlContentMig);
                            break;

                        default:
                            // For other features, execute generic enterprise feature
                            result = await window.apiManager.executeEnterpriseFeature(featureType);
                            break;
                    }

                    // Update progress
                    progressBar.style.width = '100%';
                    progressText.textContent = 'Funcionalidad empresarial completada!';

                    // Store and display results
                    this.enterpriseResult = result;
                    this.showEnterpriseResults(result);

                } catch (error) {
                    throw error;
                }
            }

            async performRealAnalysis() {
                try {
                    updateProgress(10, 'Cargando archivo...', 'Preparando datos para an√°lisis...');

                    // Create form data
                    const formData = new FormData();
                    formData.append('file', this.currentFile);

                    updateProgress(30, 'Analizando SQL...', 'Procesando c√≥digo SQL...');

                    // Call the API
                    const response = await fetch('/api/analyze/simple', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Error en el an√°lisis: ${response.statusText}`);
                    }

                    updateProgress(80, 'Procesando resultados...', 'Generando reporte de an√°lisis...');

                    const result = await response.json();

                    updateProgress(100, 'An√°lisis completado!', 'Preparando resultados...');

                    // Store results and show them in modal
                    this.analysisResult = result;

                    setTimeout(() => {
                        hideProgress();
                        showResultsInModal(result, 'analysis');
                    }, 1000);

                } catch (error) {
                    throw error;
                }
            }

            showRealResults() {
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';

                const result = this.analysisResult;

                // Display real results
                const results = `
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-success">${result.errors_found}</h4>
                                <small class="text-muted">Errors Found</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-info">${result.comments_added}</h4>
                                <small class="text-muted">Comments Added</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-warning">${result.optimizations}</h4>
                                <small class="text-muted">Optimizations</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-primary">${result.quality_score}%</h4>
                                <small class="text-muted">Quality Score</small>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <h5>File Information</h5>
                            <ul class="list-unstyled">
                                <li><strong>Filename:</strong> ${result.filename}</li>
                                <li><strong>Size:</strong> ${this.formatFileSize(result.size)}</li>
                                <li><strong>Lines:</strong> ${result.lines}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>SQL Analysis</h5>
                            <ul class="list-unstyled">
                                <li><strong>Total Statements:</strong> ${result.analysis_summary.total_statements}</li>
                                <li><strong>CREATE Statements:</strong> ${result.analysis_summary.create_statements}</li>
                                <li><strong>SELECT Statements:</strong> ${result.analysis_summary.select_statements}</li>
                                <li><strong>INSERT Statements:</strong> ${result.analysis_summary.insert_statements}</li>
                            </ul>
                        </div>
                    </div>
                `;

                document.getElementById('analysisResults').innerHTML = results;

                // Setup download
                document.getElementById('downloadResults').addEventListener('click', () => {
                    this.downloadRealResults();
                });
            }

            downloadRealResults() {
                try {
                    // Check if we have the necessary data
                    if (!this.analysisResult) {
                        throw new Error('No hay resultados de an√°lisis disponibles');
                    }

                    const formatElement = document.querySelector('input[name="downloadFormat"]:checked');
                    if (!formatElement) {
                        throw new Error('Por favor seleccione un formato de descarga');
                    }

                    const format = formatElement.value;
                    const baseFileName = this.currentFile ? this.currentFile.name.replace(/\.[^/.]+$/, '') : 'analysis';
                    const fileName = `${baseFileName}_analyzed.${format}`;

                    let content = '';
                    let mimeType = 'text/plain';

                    if (format === 'sql') {
                        content = this.analysisResult.processed_content || this.analysisResult.enhanced_sql || 'No SQL content available';
                        mimeType = 'text/plain';
                    } else if (format === 'json') {
                        content = JSON.stringify(this.analysisResult, null, 2);
                        mimeType = 'application/json';
                    } else if (format === 'html') {
                        content = this.generateHTMLReport();
                        mimeType = 'text/html';
                    } else {
                        content = this.generateTextReport();
                        mimeType = 'text/plain';
                    }

                    // Create download
                    const blob = new Blob([content], { type: mimeType });
                    const url = URL.createObjectURL(blob);
                    const element = document.createElement('a');
                    element.setAttribute('href', url);
                    element.setAttribute('download', fileName);
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                    URL.revokeObjectURL(url);

                    if (window.Utils) {
                        Utils.log('Download started:', fileName);
                        Utils.showNotification(`Descarga iniciada: ${fileName}`, 'success');
                    }

                } catch (error) {
                    if (window.Utils) {
                        Utils.showNotification('Error al descargar: ' + error.message, 'error');
                    } else {
                        alert('Error al descargar: ' + error.message);
                    }
                }
            }

            generateHTMLReport() {
                const result = this.analysisResult;
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>SQL Analysis Report - ${result.filename}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { background: #f8f9fa; padding: 20px; border-radius: 5px; }
                            .stats { display: flex; gap: 20px; margin: 20px 0; }
                            .stat { text-align: center; padding: 10px; background: #e9ecef; border-radius: 5px; }
                            pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>SQL Analysis Report</h1>
                            <p><strong>File:</strong> ${result.filename}</p>
                            <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                        </div>

                        <div class="stats">
                            <div class="stat">
                                <h3>${result.errors_found}</h3>
                                <p>Errors Found</p>
                            </div>
                            <div class="stat">
                                <h3>${result.quality_score}%</h3>
                                <p>Quality Score</p>
                            </div>
                            <div class="stat">
                                <h3>${result.analysis_summary.total_statements}</h3>
                                <p>SQL Statements</p>
                            </div>
                        </div>

                        <h2>Processed SQL Content</h2>
                        <pre>${result.processed_content}</pre>
                    </body>
                    </html>
                `;
            }

            generateTextReport() {
                const result = this.analysisResult;
                return `SQL ANALYSIS REPORT
===================

File: ${result.filename}
Size: ${this.formatFileSize(result.size)}
Lines: ${result.lines}
Generated: ${new Date().toLocaleString()}

ANALYSIS SUMMARY
================
Errors Found: ${result.errors_found}
Comments Added: ${result.comments_added}
Optimizations: ${result.optimizations}
Quality Score: ${result.quality_score}%

SQL STATEMENTS
==============
Total Statements: ${result.analysis_summary.total_statements}
CREATE Statements: ${result.analysis_summary.create_statements}
SELECT Statements: ${result.analysis_summary.select_statements}
INSERT Statements: ${result.analysis_summary.insert_statements}
UPDATE Statements: ${result.analysis_summary.update_statements}
DELETE Statements: ${result.analysis_summary.delete_statements}

PROCESSED CONTENT
=================
${result.processed_content}
`;
            }

            // Post-Analysis Feature Methods
            async autoFixErrors() {
                if (!this.currentFile) return;

                const button = document.getElementById('autoFixBtn');
                const originalText = button.innerHTML;

                try {
                    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Corrigiendo...';
                    button.disabled = true;

                    // Call auto-fix API
                    const formData = new FormData();
                    formData.append('file', this.currentFile);

                    const response = await fetch('/api/auto-fix', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Session-ID': window.SessionManager ? window.SessionManager.sessionId : ''
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();

                    // Show enhanced results
                    this.showEnhancedResults(result, 'auto-fix');

                    if (window.Utils) {
                        Utils.showNotification('Errores corregidos autom√°ticamente', 'success');
                    }

                } catch (error) {
                    if (window.Utils) {
                        Utils.showNotification('Error al corregir errores: ' + error.message, 'error');
                    } else {
                        alert('Error al corregir errores: ' + error.message);
                    }
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }

            async addComments() {
                if (!this.currentFile) return;

                const button = document.getElementById('addCommentsBtn');
                const originalText = button.innerHTML;

                try {
                    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Agregando comentarios...';
                    button.disabled = true;

                    // Call add comments API
                    const formData = new FormData();
                    formData.append('file', this.currentFile);

                    const response = await fetch('/api/add-comments', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Session-ID': window.SessionManager ? window.SessionManager.sessionId : ''
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();

                    // Show enhanced results
                    this.showEnhancedResults(result, 'comments');

                    if (window.Utils) {
                        Utils.showNotification('Comentarios agregados exitosamente', 'success');
                    }

                } catch (error) {
                    if (window.Utils) {
                        Utils.showNotification('Error al agregar comentarios: ' + error.message, 'error');
                    } else {
                        alert('Error al agregar comentarios: ' + error.message);
                    }
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }

            toggleSampleDataConfig() {
                // Open the sample data configuration modal instead of inline config
                openModal('sampleDataModal');
            }

            generateSampleDataWithConfig(recordsPerTable, useRealisticData, maintainIntegrity) {
                if (!this.currentFile) return;

                const button = document.getElementById('generateDataBtn');
                const originalText = button.innerHTML;

                try {
                    showProgress('Generando datos de prueba...', 'Configurando par√°metros...');

                    // Call the existing generateSampleData function with modal parameters
                    this.generateSampleDataInternal(recordsPerTable, useRealisticData, maintainIntegrity);

                } catch (error) {
                    hideProgress();
                    if (window.Utils) {
                        Utils.showNotification('Error al generar datos de prueba: ' + error.message, 'error');
                    }
                }
            }

            async generateSampleData() {
                // This function is called from the modal, get values from modal elements
                const recordsPerTable = document.getElementById('recordsSliderModal').value;
                const useRealisticData = document.getElementById('realisticDataModal').checked;
                const maintainIntegrity = document.getElementById('referentialIntegrityModal').checked;

                return this.generateSampleDataInternal(recordsPerTable, useRealisticData, maintainIntegrity);
            }

            async generateSampleDataInternal(recordsPerTable, useRealisticData, maintainIntegrity) {
                if (!this.currentFile) return;

                try {
                    showProgress('Generando datos de prueba...', 'Preparando configuraci√≥n...');
                    updateProgress(10, 'Enviando archivo...', 'Procesando par√°metros de generaci√≥n...');

                    // Call generate sample data API
                    const formData = new FormData();
                    formData.append('file', this.currentFile);
                    formData.append('records_per_table', recordsPerTable);
                    formData.append('realistic_data', useRealisticData);
                    formData.append('referential_integrity', maintainIntegrity);

                    updateProgress(30, 'Analizando esquema...', 'Identificando tablas y relaciones...');

                    const response = await fetch('/api/generate-sample-data', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Session-ID': window.SessionManager ? window.SessionManager.sessionId : ''
                        }
                    });

                    updateProgress(70, 'Generando datos...', 'Creando registros de prueba...');

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();

                    updateProgress(90, 'Finalizando...', 'Preparando resultados...');

                    // Show enhanced results
                    this.showEnhancedResults(result, 'sample-data');

                    updateProgress(100, 'Completado', 'Datos de prueba generados exitosamente');

                    setTimeout(() => {
                        hideProgress();
                    }, 1000);

                    if (window.Utils) {
                        Utils.showNotification('Datos de prueba generados exitosamente', 'success');
                    }

                } catch (error) {
                    if (window.Utils) {
                        Utils.showNotification('Error al generar datos de prueba: ' + error.message, 'error');
                    } else {
                        alert('Error al generar datos de prueba: ' + error.message);
                    }
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }

            showEnhancedResults(result, type) {
                // Store result for download functionality
                this.analysisResult = result;

                // Use modal instead of inline display
                showResultsInModal(result, type);

                // Legacy support - hide old results section if it exists
                const enhancedResults = document.getElementById('enhancedResults');
                if (enhancedResults) {
                    enhancedResults.style.display = 'none';
                }
            }

            showEnterpriseResults(result) {
                // Hide progress and show results
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';

                // Update results display with enterprise-specific content
                const resultsContainer = document.getElementById('resultsContainer');

                let resultsHTML = `
                    <div class="enterprise-results">
                        <h3><i class="fas fa-rocket me-2"></i>Resultados de Funcionalidad Empresarial</h3>
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>${result.message}
                        </div>
                `;

                // Add feature-specific content
                if (result.features) {
                    resultsHTML += `
                        <div class="features-list mb-3">
                            <h5>Caracter√≠sticas:</h5>
                            <ul class="list-group">
                                ${result.features.map(feature => `<li class="list-group-item">${feature}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                if (result.optimizations) {
                    resultsHTML += `
                        <div class="optimizations-list mb-3">
                            <h5>Optimizaciones Sugeridas:</h5>
                            ${result.optimizations.map(opt => `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h6 class="card-title">${opt.description}</h6>
                                        <p class="card-text">Impacto: ${opt.impact}</p>
                                        ${opt.sql ? `<code class="d-block bg-light p-2">${opt.sql}</code>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                if (result.vulnerabilities) {
                    resultsHTML += `
                        <div class="vulnerabilities-list mb-3">
                            <h5>Vulnerabilidades Detectadas:</h5>
                            ${result.vulnerabilities.map(vuln => `
                                <div class="alert alert-warning">
                                    <h6><strong>${vuln.description}</strong></h6>
                                    <p><strong>Severidad:</strong> ${vuln.severity}</p>
                                    <p><strong>Recomendaci√≥n:</strong> ${vuln.recommendation}</p>
                                    ${vuln.line ? `<p><strong>L√≠nea:</strong> ${vuln.line}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                if (result.security_score !== undefined) {
                    resultsHTML += `
                        <div class="security-score mb-3">
                            <h5>Puntuaci√≥n de Seguridad: ${result.security_score}/100</h5>
                            <div class="progress">
                                <div class="progress-bar ${result.security_score >= 80 ? 'bg-success' : result.security_score >= 60 ? 'bg-warning' : 'bg-danger'}"
                                     style="width: ${result.security_score}%"></div>
                            </div>
                        </div>
                    `;
                }

                resultsHTML += `
                        <div class="mt-4">
                            <button class="btn btn-primary" onclick="window.sqlAnalyzer.downloadEnterpriseResults()">
                                <i class="fas fa-download me-2"></i>Descargar Resultados
                            </button>
                        </div>
                    </div>
                `;

                resultsContainer.innerHTML = resultsHTML;
            }

            async downloadEnterpriseResults() {
                try {
                    const result = this.enterpriseResult || this.analysisResult;
                    const filename = this.currentFile ? this.currentFile.name : 'analysis';

                    await window.apiManager.downloadFormat(
                        this.selectedFormat || 'json_analysis',
                        result,
                        filename
                    );
                } catch (error) {
                    if (window.Utils) Utils.error('Error downloading results:', error);
                    alert('Error al descargar resultados: ' + error.message);
                }
            }

            async showStatistics() {
                try {
                    // Show statistics panel
                    document.getElementById('statisticsPanel').style.display = 'block';

                    // Load statistics data
                    await this.refreshStatistics();

                } catch (error) {
                    if (window.Utils) Utils.error('Error showing statistics:', error);
                    alert('Error al mostrar estad√≠sticas: ' + error.message);
                }
            }

            hideStatistics() {
                document.getElementById('statisticsPanel').style.display = 'none';
            }

            async refreshStatistics() {
                try {
                    // Get usage statistics
                    const usageStats = await window.apiManager.getUsageStatistics('24h');

                    // Update statistics display
                    document.getElementById('totalAnalyses').textContent = usageStats.statistics.total_analyses;
                    document.getElementById('totalFiles').textContent = usageStats.statistics.total_files_processed;
                    document.getElementById('averageQuality').textContent = usageStats.statistics.average_quality_score + '%';

                    // Update common errors
                    const commonErrorsContainer = document.getElementById('commonErrors');
                    commonErrorsContainer.innerHTML = '';

                    usageStats.statistics.most_common_errors.forEach(error => {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'd-flex justify-content-between';
                        errorDiv.innerHTML = `
                            <span>${this.formatErrorType(error.type)}</span>
                            <span class="badge bg-warning">${error.count}</span>
                        `;
                        commonErrorsContainer.appendChild(errorDiv);
                    });

                    // Update popular formats
                    const popularFormatsContainer = document.getElementById('popularFormats');
                    popularFormatsContainer.innerHTML = '';

                    Object.entries(usageStats.statistics.format_usage).forEach(([format, count]) => {
                        const formatDiv = document.createElement('div');
                        formatDiv.className = 'd-flex justify-content-between';
                        formatDiv.innerHTML = `
                            <span>${this.formatFormatName(format)}</span>
                            <span class="badge bg-primary">${count}</span>
                        `;
                        popularFormatsContainer.appendChild(formatDiv);
                    });

                    if (window.Utils) {
                        Utils.showNotification('Estad√≠sticas actualizadas', 'success');
                    }

                } catch (error) {
                    if (window.Utils) Utils.error('Error refreshing statistics:', error);
                    alert('Error al actualizar estad√≠sticas: ' + error.message);
                }
            }

            formatErrorType(type) {
                const typeMap = {
                    'syntax_punctuation': 'Sintaxis y puntuaci√≥n',
                    'logical_performance': 'Rendimiento',
                    'logical_security': 'Seguridad',
                    'schema_design': 'Dise√±o de esquema',
                    'data_types': 'Tipos de datos'
                };
                return typeMap[type] || type;
            }

            formatFormatName(format) {
                const formatMap = {
                    'enhanced_sql': 'SQL Mejorado',
                    'html_report': 'Reporte HTML',
                    'pdf_report': 'PDF',
                    'json_analysis': 'JSON',
                    'excel_workbook': 'Excel'
                };
                return formatMap[format] || format;
            }

            async downloadResults() {
                try {
                    const result = this.enterpriseResult || this.analysisResult;
                    const filename = this.currentFile ? this.currentFile.name : 'analysis';
                    const format = this.selectedFormat || 'enhanced_sql';

                    await window.apiManager.downloadFormat(format, result, filename);

                } catch (error) {
                    if (window.Utils) Utils.error('Error downloading results:', error);
                    alert('Error al descargar resultados: ' + error.message);
                }
            }
        }

        // ========================================================================
        // SIMPLE FILE UPLOAD AND ANALYSIS (NO WEBSOCKET)
        // ========================================================================

        function analyzeFile() {
            const fileInput = document.getElementById('sqlFile');

            if (!fileInput.files[0]) {
                SimpleUtils.showNotification('Por favor selecciona un archivo SQL', 'warning');
                return;
            }

            // Mostrar estado de carga
            const analyzeBtn = document.querySelector('.analyze-btn');
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analizando...';
            analyzeBtn.disabled = true;

            // Usar SimpleUtils para subir archivo
            SimpleUtils.uploadFile(
                fileInput,
                // onProgress
                function (progress) {
                    console.log(`Progreso: ${progress}%`);
                },
                // onComplete
                function (result) {
                    analyzeBtn.innerHTML = originalText;
                    analyzeBtn.disabled = false;

                    if (result.success !== false) {
                        // Mostrar resultados
                        const resultsHtml = SimpleUtils.formatAnalysisResults(result);
                        document.getElementById('results').innerHTML = resultsHtml;
                        document.getElementById('results').style.display = 'block';

                        // Scroll a resultados
                        document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

                        SimpleUtils.showNotification('An√°lisis completado exitosamente', 'success');
                    } else {
                        SimpleUtils.showNotification(result.error || 'Error en el an√°lisis', 'error');
                    }
                },
                // onError
                function (error) {
                    analyzeBtn.innerHTML = originalText;
                    analyzeBtn.disabled = false;
                    SimpleUtils.showNotification(error, 'error');
                }
            );



            function displayResults(data) {
                const resultsDiv = document.getElementById('results');
                if (!resultsDiv) return;

                let html = `
                <div class="results-container">
                    <h3>üìä Resultados del An√°lisis</h3>
                    <div class="result-summary">
                        <p><strong>Archivo:</strong> ${data.filename}</p>
                        <p><strong>L√≠neas:</strong> ${data.lines}</p>
                        <p><strong>Score de Calidad:</strong> ${data.quality_score}%</p>
                        <p><strong>Total de Errores:</strong> ${data.summary?.total_errors || 0}</p>
                        <p><strong>Advertencias:</strong> ${data.summary?.total_warnings || 0}</p>
                    </div>
            `;

                if (data.errors && data.errors.length > 0) {
                    html += '<h4>üîç Errores y Advertencias Detectados:</h4><ul>';
                    data.errors.forEach(error => {
                        const icon = error.severity === 'ERROR' ? '‚ùå' : '‚ö†Ô∏è';
                        html += `<li>${icon} L√≠nea ${error.line}: ${error.message}</li>`;
                    });
                    html += '</ul>';
                }

                html += `
                    <div class="download-section">
                        <h4>üì• Descargar Resultados:</h4>
                        <button onclick="downloadResults('json')" class="btn btn-primary me-2">
                            <i class="fas fa-download me-1"></i>JSON
                        </button>
                        <button onclick="downloadResults('txt')" class="btn btn-secondary">
                            <i class="fas fa-download me-1"></i>TXT
                        </button>
                    </div>
                </div>
            `;

                resultsDiv.innerHTML = html;
                resultsDiv.style.display = 'block';
            }

            function downloadResults(format) {
                window.open(`/api/download/${format}`, '_blank');
            }

            // Initialize when page loads
            document.addEventListener('DOMContentLoaded', () => {
                // Simple initialization without WebSocket
                console.log('üöÄ SQL Analyzer cargado (modo simple)');

                // Initialize Bootstrap tooltips
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            });
    </script>
</body>

</html>