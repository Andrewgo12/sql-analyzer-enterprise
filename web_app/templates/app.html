<!DOCTYPE html>
<!--
    ============================================================================
    SQL ANALYZER ENTERPRISE - MAIN APPLICATION TEMPLATE
    ============================================================================

    This is the main application template that serves as the foundation for the
    SQL Analyzer Enterprise web application. It provides:

    - Responsive layout structure with header, sidebar, and main content areas
    - Professional enterprise styling and theming
    - Authentication integration and user session management
    - Navigation system for different application views
    - Modal dialogs for various user interactions
    - Real-time notifications and feedback system

    Author: SQL Analyzer Enterprise Team
    Version: 1.0.0
    Last Updated: 2025-01-13
    ============================================================================
-->
<html lang="es">

<head>
    <!-- ========================================================================
         DOCUMENT METADATA AND CONFIGURATION
         ======================================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Analyzer Enterprise</title>

    <!-- ========================================================================
         EXTERNAL FONT RESOURCES
         Professional typography for enterprise applications
         ======================================================================== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ========================================================================
         ICON LIBRARIES
         FontAwesome for professional iconography
         ======================================================================== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ========================================================================
         CSS FRAMEWORK
         Bootstrap 5 for responsive grid system and components
         ======================================================================== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ========================================================================
         ENTERPRISE STYLESHEETS
         Custom CSS for professional enterprise appearance
         ======================================================================== -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/dashboard-enterprise.css">
    <link rel="stylesheet" href="/static/css/modals-enterprise.css">

    <!-- ========================================================================
         INLINE STYLES FOR APPLICATION LAYOUT
         Critical layout styles that must be loaded immediately
         ======================================================================== -->
    <style>
        /* ====================================================================
           MAIN APPLICATION CONTAINER
           Full-height flex container for the entire application
           ==================================================================== */
        .app-container {
            min-height: 100vh;
            /* Full viewport height */
            display: flex;
            /* Flexbox layout */
            flex-direction: column;
            /* Vertical stacking */
        }

        /* ====================================================================
           APPLICATION HEADER
           Sticky header with navigation and user controls
           ==================================================================== */
        .app-header {
            background: var(--bg-primary);
            /* Primary background */
            border-bottom: 1px solid var(--border-color-light);
            /* Subtle border */
            box-shadow: var(--shadow-sm);
            /* Light shadow */
            position: sticky;
            /* Sticky positioning */
            top: 0;
            /* Stick to top */
            z-index: 1000;
            /* Above other content */
        }

        /* ====================================================================
           MAIN CONTENT AREA
           Flexible container for sidebar and main content
           ==================================================================== */
        .app-main {
            flex: 1;
            /* Take remaining space */
            display: flex;
            /* Horizontal layout */
            min-height: calc(100vh - 70px);
            /* Full height minus header */
        }

        /* ====================================================================
           SIDEBAR NAVIGATION
           Collapsible sidebar for navigation menu
           ==================================================================== */
        .app-sidebar {
            width: 280px;
            /* Default width */
            background: var(--bg-primary);
            /* Primary background */
            border-right: 1px solid var(--border-color-light);
            /* Right border */
            box-shadow: var(--shadow-sm);
            /* Light shadow */
            transition: var(--transition);
            /* Smooth transitions */
            overflow-y: auto;
            /* Scrollable content */
        }

        /* Collapsed sidebar state for mobile/compact view */
        .app-sidebar.collapsed {
            width: 70px;
            /* Collapsed width */
        }

        /* ====================================================================
           MAIN CONTENT AREA
           Primary content display area with scrolling
           ==================================================================== */
        .app-content {
            flex: 1;
            /* Take remaining space */
            background: var(--bg-secondary);
            /* Secondary background */
            overflow-y: auto;
            /* Vertical scrolling */
            position: relative;
            /* For absolute positioning */
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.25rem;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-brand {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-brand:hover {
            color: var(--primary-dark);
            text-decoration: none;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            padding: 0 1rem;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            border-radius: 0;
            position: relative;
        }

        .nav-link:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            text-decoration: none;
        }

        .nav-link.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-color);
            border-right: 3px solid var(--primary-color);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        .nav-text {
            transition: var(--transition);
        }

        .app-sidebar.collapsed .nav-text,
        .app-sidebar.collapsed .nav-section-title {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .loading-overlay.show {
            display: flex;
        }

        .content-wrapper {
            padding: 2rem;
            max-width: 100%;
            transition: opacity 0.3s ease;
        }

        @media (max-width: 768px) {
            .app-sidebar {
                position: fixed;
                left: -280px;
                height: 100vh;
                z-index: 1001;
            }

            .app-sidebar.show {
                left: 0;
            }

            .app-content {
                margin-left: 0;
            }

            .sidebar-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                display: none;
            }

            .sidebar-backdrop.show {
                display: block;
            }
        }
    </style>
</head>

<body>
    <!-- ========================================================================
         MAIN APPLICATION CONTAINER
         Root container that holds all application views and components
         ======================================================================== -->
    <div class="app-container" id="app">

        <!-- ====================================================================
             AUTHENTICATION VIEW
             Login/registration interface - shown when user is not authenticated
             - Initially hidden, displayed by JavaScript when needed
             - Contains login form, registration form, and password recovery
             - Managed by auth.js module
             ==================================================================== -->
        <div id="auth-view" class="auth-view" style="display: none;">
            <!-- Auth content will be dynamically loaded here by JavaScript -->
        </div>

        <!-- ====================================================================
             MAIN APPLICATION INTERFACE
             Primary application interface - shown when user is authenticated
             - Initially hidden, displayed after successful authentication
             - Contains header, sidebar navigation, and main content area
             - Managed by app-controller.js and navigation.js modules
             ==================================================================== -->
        <div id="main-app" class="main-app" style="display: none;">

            <!-- ================================================================
                 APPLICATION HEADER
                 Top navigation bar with branding, controls, and user menu
                 - Sticky positioning for always-visible navigation
                 - Responsive design with mobile-specific controls
                 - Contains sidebar toggle, branding, and user actions
                 ================================================================ -->
            <header class="app-header">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-between py-2">

                        <!-- ========================================================
                             LEFT SIDE: NAVIGATION CONTROLS AND BRANDING
                             ======================================================== -->
                        <div class="d-flex align-items-center gap-3">
                            <!-- Mobile sidebar toggle (visible on small screens) -->
                            <button class="sidebar-toggle d-lg-none" id="sidebar-toggle-mobile">
                                <i class="fas fa-bars"></i>
                            </button>
                            <!-- Desktop sidebar toggle (visible on large screens) -->
                            <button class="sidebar-toggle d-none d-lg-block" id="sidebar-toggle-desktop">
                                <i class="fas fa-bars"></i>
                            </button>
                            <!-- Application branding and logo -->
                            <a href="#" class="nav-brand" id="nav-brand-link">
                                <i class="fas fa-database"></i>
                                <span class="brand-text">SQL Analyzer Enterprise</span>
                            </a>
                        </div>

                        <div class="d-flex align-items-center gap-3">
                            <!-- Connection Status -->
                            <div class="d-flex align-items-center gap-2">
                                <span class="badge bg-success" id="connection-status">Connected</span>
                            </div>

                            <!-- User Menu -->
                            <div class="user-menu">
                                <div class="user-avatar" id="user-avatar">
                                    U
                                </div>
                                <div class="dropdown-menu dropdown-menu-end" id="user-dropdown">
                                    <a class="dropdown-item" href="#" id="profile-link">
                                        <i class="fas fa-user me-2"></i>Profile
                                    </a>
                                    <a class="dropdown-item" href="#" id="settings-link">
                                        <i class="fas fa-cog me-2"></i>Settings
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#" id="signout-link">
                                        <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <main class="app-main">
                <!-- Sidebar -->
                <aside class="app-sidebar" id="app-sidebar">
                    <nav class="sidebar-nav">
                        <!-- Main Section -->
                        <div class="nav-section">
                            <div class="nav-section-title">Main</div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="dashboard">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span class="nav-text">Dashboard</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="upload">
                                    <i class="fas fa-upload"></i>
                                    <span class="nav-text">Upload Files</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="history">
                                    <i class="fas fa-history"></i>
                                    <span class="nav-text">Analysis History</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="results">
                                    <i class="fas fa-chart-line"></i>
                                    <span class="nav-text">Results</span>
                                </a>
                            </div>
                        </div>

                        <!-- Tools Section -->
                        <div class="nav-section">
                            <div class="nav-section-title">Tools</div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="analyzer">
                                    <i class="fas fa-search"></i>
                                    <span class="nav-text">SQL Analyzer</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="optimizer">
                                    <i class="fas fa-bolt"></i>
                                    <span class="nav-text">Performance</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="security">
                                    <i class="fas fa-shield-alt"></i>
                                    <span class="nav-text">Security Scan</span>
                                </a>
                            </div>
                        </div>

                        <!-- Account Section -->
                        <div class="nav-section">
                            <div class="nav-section-title">Account</div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="profile">
                                    <i class="fas fa-user"></i>
                                    <span class="nav-text">Profile</span>
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-view="settings">
                                    <i class="fas fa-cog"></i>
                                    <span class="nav-text">Settings</span>
                                </a>
                            </div>
                        </div>
                    </nav>
                </aside>

                <!-- Main Content Area -->
                <div class="app-content">
                    <div class="loading-overlay" id="loading-overlay">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>

                    <div id="content-container" class="content-wrapper">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </main>
        </div>

        <!-- Mobile Sidebar Backdrop -->
        <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
    </div>

    <!-- Professional Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>

    <!-- Modular JavaScript Architecture -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/notifications.js"></script>
    <script src="/static/js/modals.js"></script>
    <script src="/static/js/websocket-manager.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/upload.js"></script>
    <script src="/static/js/analysis.js"></script>
    <script src="/static/js/navigation.js"></script>
    <script src="/static/js/results.js"></script>
    <script src="/static/js/events.js"></script>
    <script src="/static/js/header-events.js"></script>

    <!-- Application Controller -->
    <script src="/static/js/app-controller.js"></script>

    <!-- Navigation Testing Suite (Development Only) -->
    <script src="/static/js/navigation-tests.js"></script>
    <script src="/static/js/test-dashboard.js"></script>
    <script src="/static/js/comprehensive-test.js"></script>

    <!-- Initialize application -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Initializing SQL Analyzer Enterprise...');

            try {
                // Initialize all managers in correct order
                console.log('📋 Initializing notification system...');
                window.notificationManager = new NotificationManager();

                console.log('🔧 Initializing modal system...');
                window.modalManager = new ModalManager();

                console.log('🔐 Initializing authentication...');
                window.authManager = new AuthManager();

                console.log('📤 Initializing upload manager...');
                window.uploadManager = new UploadManager();

                console.log('🔍 Initializing analysis manager...');
                window.analysisManager = new AnalysisManager();

                console.log('🌐 Initializing API manager...');
                window.apiManager = new ApiManager();

                console.log('📊 Initializing results manager...');
                window.resultsManager = new ResultsManager();

                console.log('🎮 Initializing main app controller...');
                window.appController = new AppController();

                console.log('✅ SQL Analyzer Enterprise initialized successfully');

                // Show welcome notification after a brief delay
                setTimeout(() => {
                    if (window.showNotification) {
                        showNotification('Sistema inicializado correctamente', 'success', 3000);
                    }
                }, 1000);

            } catch (error) {
                console.error('❌ Initialization error:', error);

                // Show error notification
                setTimeout(() => {
                    if (window.showNotification) {
                        showNotification('Error al inicializar el sistema', 'error');
                    } else {
                        alert('Error al inicializar el sistema: ' + error.message);
                    }
                }, 500);
            }
        });

        // Handle any uncaught errors
        window.addEventListener('error', (event) => {
            console.error('❌ Global error:', event.error);
            if (window.showNotification) {
                showNotification('Se produjo un error inesperado', 'error');
            }
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('❌ Unhandled promise rejection:', event.reason);
            if (window.showNotification) {
                showNotification('Error de conexión o procesamiento', 'error');
            }
        });
    </script>
</body>

</html>